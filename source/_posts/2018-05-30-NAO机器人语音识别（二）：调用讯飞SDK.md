---
title: 2018-05-30-NAO机器人语音识别（二）：调用讯飞SDK
urlname: e516c4fd461c1b52e8ca82daa44d061e
date: '2022-12-09 20:02:26 +0800'
tags: []
categories: []
---

<hr />
<p>author: zyqzyq

date: 2018-05-25 10:12:32+00:00

layout: post

title: NAO 机器人语音识别（二）：调用讯飞 SDK

categories: nao

key: 20180530

tags:</p>

<ul>
<li>nao</li>
</ul>
<hr />
<h1>准备工作</h1>
<p>ALSoundProcessing模块 <a href="http://doc.aldebaran.com/2-1/dev/cpp/examples/audio/soundprocessing/soundprocessing.html#cpp-examples-sound-processing" target="_blank">下载地址</a></p>
<p>讯飞LINUX SDK <a href="http://www.xfyun.cn/" target="_blank">讯飞官网</a></p>
<h1>安装 SDK</h1>
<pre><code>将sdk中的 libs include 文件夹拷贝到ALSoundProcessing文件夹下
编辑CMakeList.txt添加环境变量
</code></pre>
<h3>导入asr_sample</h3>
<ol>
<li>将讯飞识别的单文件直接复制拷到alsoundprocessing.cpp文件中</li>
<li>将讯飞login函数放入init函数内启动（以便模块启动后调用）</li>
<li>将讯飞logout函数放入~ALSoundProcessing函数中（模块停止后退出，避免下次模块启动出现异常）</li>
<li>清空process函数并编辑，实现将nao缓存区的音频数据同时QISRAudioWrite函数实时上传到讯飞服务器</li>
<li>通过QISRGetResult获取所有音频结果并解析。</li>
</ol>
<p>（初步完成语音识别功能）</p>
<h3>调整</h3>
<p>将模块名修改为ALSoundRecognition(避免冲突，可定义)

在头文件中加入方法，方便外部调用。</p>

<pre><code>public:
  void process(const int & nbOfChannels,
               const int & nbrOfSamplesByChannel,
               const AL_SOUND_FORMAT * buffer,
               const ALValue & timeStamp);

  void startSession();

  void stopSession();

  void restartSession();

  int getStatus();

  std::string getResult();

  void restart();

</code></pre>
<h1>编译执行</h1>
<p>成功运行以后运行如下代码（默认选择remote模式）</p>
<pre><code>qibuild make
</code></pre>
<p>即可在电脑上运行测试了。</p>
